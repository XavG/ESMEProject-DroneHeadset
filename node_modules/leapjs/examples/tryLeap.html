<html>
<head>
	<title></title>

</head>
<body>
	<canvas id="canv" style ="width:500px;height:500px;"></canvas>
	
		<script src="../leap.js"></script>
		<script type="text/javascript">

		var canvas = window.document.getElementById('canv');
		console.log(canvas);

		//on dit au canvas qu'on veux dessiner en 2d
		var c = canvas.getContext('2d');
		var width = canvas.width;
		var height = canvas.height;

		//on crée ce qu'on veux metre dans le canvas
		/*var img = document.createElement('img');
		img.src = "img/unicorn1.png";		 

		/*
		**creation du controller de la leap
		**responsable de tout les event liée a la leap
		**determine aussi quand se co a la leap
		**on va lui passer des données etc
		*/
		var controller = new Leap.Controller({enableGestures: true});

		// creation d'un listner qui nous dit quand on est co a la leap

		controller.on( 'connect', function() {
			console.log('connected');
		});

		//check la connection de la leap prend du temps a detect

		controller.on( 'deviceConnected' , function() {

			console.log( 'A Leap device has been connected.' );

		});

		// quand on deco une leap
		controller.on( 'deviceDisconnected' , function() {

			console.log( 'A Leap device has been disconnected.' );

		});

		controller.on( 'ready', function() {
			//c.drawImage( img, 0, 0 );
			//canvas.appendChild(img);
			console.log('leap ready');

		});

		/*	
		**detect quand une frame est lancée
		**frame contient toute les infos des frames
		**peux correspondre a animationFrame ou deviceFrame
		**on peux choisir l'un ou l'autre en passant l'un des deux mots clef
		**ou alors simplement a la creation du controller comme bellow
		**Leap.Controller({frameEventName: "deviceFrame"});
		*/
		controller.on( 'frame', function ( frame ) {
			//longeur du tableau qui contient les doights
			var numOfFinger = frame.fingers.length;
			c.clearRect( 0, 0, width, height );
			
			/*c.font = "30px Arial";
			c.textAlign = 'center';
			c.textBaseline = 'middle';
			c.fillText( numOfFinger, width/2, height/2 );
			*/

			for (var i = 0; i < frame.hands.length; i++) {
				
				var hand = frame.hands[i];
				//on recup la position de la main
				var handPos = leapToScene( frame, hand.palmPosition );
				

				for (var j = 0; j < hand.fingers.length; j++) {
				
					var finger = hand.fingers[j];
					var fingerPos = leapToScene( frame, finger.tipPosition );

					//on dessine les liens
					c.strokeStyle = "#FFA040";
					c.lineWidth = 3;
					c.beginPath();
					c.moveTo( handPos[0], handPos[1] );
					c.lineTo( fingerPos[0], fingerPos[1] );
					c.closePath();
					c.stroke();

					//ensuite les doigts
					c.strokeStyle = "#39AECF";
					c.lineWidth = 5;
					c.beginPath();
					c.arc( fingerPos[0], fingerPos[1], 6, 0, Math.PI*2 );
					c.closePath();
					c.stroke();
				}

				//enfin les mains
				c.fillStyle = "#FF5A40";
				c.beginPath();
				/*
				**2 premier arg position
				**3eme radius on a pris ca au hazzard enfin par essay
				**4eme et 5eme le debut et la fin de l'angle a decrire en radiant
				*/
				c.arc( handPos[0], handPos[1], 10, 0, Math.PI*2 );
				c.closePath();
				c.fill();
			}

		});

		/*
		**fonction qui s'occupe de caller les coordonées avec celle de la leap
		**on passe frame par ce que l'interaction box est dedant
		**leapPos est la position courrante de l'objet dans la box
		*/
		function leapToScene ( frame, leapPos ) {
			/* 
			**recupere l'interaction box qui est l'endroi ou la main se trouve
			**et ou on va focus l'observation
			*/
			var iBox = frame.interactionBox;
			/*
			**iBox.center[1] renvois le centre de l'axe Y
			**renvoie la moitée de l'axe Y
			**de même pour le x
			**on recupere ici le top gauche de la box detecter par la leap
			*/
			var top = iBox.center[1] + iBox.size[1]/2;
			var left = iBox.center[0] - iBox.size[0]/2;

			//on recup la position courante de l'objet dans la leap i think
			var x = leapPos[0] - left;
			var y = leapPos[1] - top; 

			/*
			**on check que x et y sont bien dans le repere
			**on les divise par la taille max avant de les passer 
			**en % a la taille du canvas
			*/
			x /= iBox.size[0];
			y /= iBox.size[1];

			x *= width;
			y *= height;

			//on retourn -y par ce que le canvas a des coordonée negative sur y
			return [ x, -y ];


		}

		/*
		**animationFrame gere la loop de temps pour moi et s'occupe de tout par rapport au mouvement
		**60fps
		**sauvegarde les event qui sont pas forcement pris au moment ou la leap film
		**due a son peu de fps
		*/

		/*
		**deviceFrame same mais avec qq diff
		**plus souvent appeler que animationFrame
		**a chaque nouvelle frame cette fct est appellée
		**peu recommander 
		*/

		//Connection a la leap has to be call!
		controller.connect(); 

	</script>
  

</body>
</html>